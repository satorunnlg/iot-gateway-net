<!doctype html>
<html lang="ja">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>サインイン - AMR</title>
	<link rel="icon" href="./assets/favicon.ico" />
	<link rel="stylesheet" href="style.css" />
	<style>
		/* ページ固有: ロゴを中央に大きく表示 */
		.logo-large {
			display: block;
			margin: 30px auto 20px;
			max-width: 180px;
			height: auto;
		}
	</style>
</head>

<body>
	<div class="container">
		<header class="header">
			<div class="brand">
				<div class="brand-badge"></div> Iot-gateway-net
			</div>
			<div class="header-actions">
				<span class="badge"><span class="dot idle"></span>offline</span>
			</div>
		</header>

		<div class="card wrap">
			<!-- ロゴをフォームの中央上部に配置 -->
			<img src="./assets/badge.png" alt="App Logo" class="logo-large" />

			<h1 class="card-title">サインイン</h1>
			<div class="card-subtitle">初回はメール＋パスワード／2回目以降はパスキー（端末登録済み）</div>

			<!-- 2回目以降（パスキー） -->
			<div id="passkeyPane" class="row hidden">
				<label class="label">パスキー（WebAuthn）でサインイン</label>
				<div class="inline">
					<input id="rememberedUser" class="input grow" type="email" autocomplete="username" readonly />
					<button id="btnPasskey" class="btn btn-primary">パスキーでサインイン</button>
				</div>
				<div class="small">他の方法でサインインする場合は <span id="switchToPw" class="link">こちら</span></div>
			</div>

			<!-- 初回（メール/パスワード） -->
			<div id="passwordPane" class="row">
				<label class="label">メール + パスワードでサインイン</label>
				<input id="inUser" class="input" type="email" placeholder="メールアドレス" autocomplete="username" />
				<input id="inPw" class="input" type="password" placeholder="パスワード" autocomplete="current-password" />
				<button id="btnPassword" class="btn btn-primary">サインイン</button>
				<div class="small">※ 初回作成ユーザーは、この後に<strong>パスワード変更</strong>が必要になる場合があります。</div>
			</div>

			<!-- NEW_PASSWORD_REQUIRED 対応 -->
			<div id="newPwPane" class="row hidden">
				<label class="label">パスワード変更が必要です</label>
				<input id="inNewPw" class="input" type="password" placeholder="新しいパスワード" autocomplete="new-password" />
				<button id="btnNewPw" class="btn btn-primary">変更して続行</button>
				<div class="small">ポリシーに合致する強度のパスワードを設定してください。</div>
			</div>

			<!-- ログイン後：パスキー登録（任意／推奨） -->
			<div id="registerPane" class="row hidden">
				<label class="label">この端末をパスキー登録（推奨）</label>
				<button id="btnRegister" class="btn btn-primary">パスキーを登録</button>
				<div class="small">登録後、次回からは生体認証などで入力レス・サインインできます。</div>
				<button id="btnGotoApp" class="btn">AMR 操作画面へ進む</button>
			</div>

			<div id="status" class="small">—</div>
		</div>
	</div>

	<script src="config.js"></script>
	<script src="signin.js"></script>
</body>

</html>